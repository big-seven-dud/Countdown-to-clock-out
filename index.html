<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¤¾ç•œæ•‘è´–å„€å¼</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg: #000000;
            --card: #121212;
            --accent: #BB86FC;
            --danger: #CF6679;
            --success: #03DAC6;
            --text: #E1E1E1;
        }

        body {
            margin: 0; background: var(--bg); color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex; align-items: center; justify-content: center; height: 100vh;
        }

        .container {
            width: 90%; max-width: 360px; padding: 40px 20px;
            background: var(--card); border-radius: 32px;
            text-align: center; border: 1px solid #333;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }

        .status-dot {
            display: inline-flex; align-items: center; gap: 8px;
            font-size: 0.85rem; color: #888; margin-bottom: 20px;
        }
        .dot { width: 8px; height: 8px; border-radius: 50%; background: #555; }
        .dot.active { background: var(--success); box-shadow: 0 0 10px var(--success); }

        #timer {
            font-size: 4.5rem; font-weight: 800; margin: 10px 0;
            letter-spacing: -3px; font-variant-numeric: tabular-nums;
        }

        .quote { font-size: 1rem; color: #aaa; min-height: 50px; margin-bottom: 30px; line-height: 1.5; }

        .btn {
            width: 100%; padding: 16px; border-radius: 16px; border: none;
            font-size: 1rem; font-weight: 700; cursor: pointer;
            transition: 0.2s; margin-bottom: 12px;
        }
        .btn-primary { background: white; color: black; }
        .btn-outline { background: transparent; border: 1px solid #444; color: #ccc; }
        .btn:active { transform: scale(0.96); }

        /* è¨­å®šæ¡† */
        .settings { font-size: 0.8rem; color: #555; margin-top: 20px; text-decoration: underline; cursor: pointer; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div class="status-dot">
        <div class="dot active" id="dotIcon"></div>
        <span id="statusText">ç³»çµ±æ­£å¸¸é‹è¡Œ</span>
    </div>
    
    <div id="timer">00:00</div>
    
    <div class="quote" id="quote">ã€Œ æ­£åœ¨æ€è€ƒè¦é»å“ªå®¶å¤–é€... ã€</div>

    <div class="btn-group">
        <button id="offWorkBtn" class="btn btn-primary" onclick="finishWork()">ğŸ‘‹ ç™»å‡ºç¤¾æœƒ (ä¸‹ç­)</button>
        <button id="extraWorkBtn" class="btn btn-outline hidden" onclick="startExtraWork()">ğŸ’€ è¢«è¿«åŠ ç­ (å¤–æ´¾)</button>
        <button id="holidayBtn" class="btn btn-outline" onclick="setHoliday()">ğŸ–ï¸ ä»Šæ—¥æ”¾å‡</button>
    </div>

    <div class="settings" onclick="adjustTime()">èª¿æ•´ä»Šæ—¥ä¸‹ç­æ™‚é–“</div>
</div>

<script>
    let customTime = localStorage.getItem('offTime') || "18:15";
    
    const quotes = {
        work: ["åˆ¥çœ‹æˆ‘ï¼Œçœ‹è¢å¹•ã€‚", "è–ªæ°´æ˜¯ç²¾ç¥æå¤±è²»ã€‚", "ä»Šå¤©çš„æˆ‘ä¾ç„¶åœ¨æ›¿è€é—†æ›è·‘è»Šã€‚"],
        slave: ["åŠ ç­åªæœ‰ 0 æ¬¡è·Ÿç„¡æ•¸æ¬¡ã€‚", "è€é—†æ²’èµ°ï¼Œæˆ‘çš„éˆé­‚ä¹Ÿèµ°ä¸äº†ã€‚", "é€™ç¨®ç”Ÿæ´»ï¼Œç‹—çœ‹äº†éƒ½æ–é ­ã€‚"],
        free: ["è‡ªç”±çš„ç©ºæ°£çœŸç”œã€‚", "å·²é–‹å•Ÿä¸è®€ä¸å›æ¨¡å¼ã€‚", "ä»Šæ™šçš„ç›®æ¨™æ˜¯ç¡åˆ°è‡ªç„¶é†’ã€‚"],
        weekend: ["é€±æœ«æ„‰å¿«ï¼Œå¸Œæœ›åˆ¥çœ‹åˆ° LINE ç¾¤çµ„ã€‚"]
    };

    function update() {
        const now = new Date();
        const day = now.getDay(); // 0: æ—¥, 6: å…­
        const isWeekend = (day === 0 || day === 6);
        const [offH, offM] = customTime.split(":").map(Number);
        
        const isOff = localStorage.getItem('isOff') === 'true';
        const isHoli = localStorage.getItem('isHoli') === 'true';
        const forceWork = localStorage.getItem('forceWork') === 'true';

        const timerEl = document.getElementById('timer');
        const quoteEl = document.getElementById('quote');
        const dot = document.getElementById('dotIcon');
        const statusEl = document.getElementById('statusText');
        const offBtn = document.getElementById('offWorkBtn');
        const extraBtn = document.getElementById('extraWorkBtn');
        const holiBtn = document.getElementById('holidayBtn');

        // 1. é€±æœ«æ¨¡å¼ (ä¸”æ²’è¢«å¼·åˆ¶åŠ ç­)
        if (isWeekend && !forceWork) {
            timerEl.innerText = "CHILL";
            quoteEl.innerText = quotes.weekend[0];
            dot.style.background = "var(--accent)";
            statusEl.innerText = "é€±æœ«è€å»¢ä¸­";
            offBtn.classList.add('hidden');
            holiBtn.classList.add('hidden');
            extraBtn.classList.remove('hidden');
            return;
        }

        // 2. è‡ªç”±æ¨¡å¼ (å·²ä¸‹ç­æˆ–ä»Šæ—¥æ”¾å‡)
        if (isOff || isHoli) {
            timerEl.innerText = "DONE";
            quoteEl.innerText = quotes.free[0];
            dot.style.background = "var(--accent)";
            statusEl.innerText = "è‡ªç”±èº«";
            offBtn.classList.add('hidden');
            holiBtn.classList.add('hidden');
            extraBtn.classList.add('hidden');
            return;
        }

        // 3. å·¥ä½œæˆ–åŠ ç­æ¨¡å¼
        let target = new Date();
        target.setHours(offH, offM, 0, 0);
        
        if (now >= target) {
            // è¶…æ™‚åŠ ç­
            timerEl.innerText = formatDiff(now - target);
            timerEl.style.color = "var(--danger)";
            quoteEl.innerText = quotes.slave[Math.floor(Math.random()*quotes.slave.length)];
            statusEl.innerText = "æ­£åœ¨è¢«ç¤¾æœƒæ¯’æ‰“";
            dot.style.background = "var(--danger)";
            offBtn.classList.remove('hidden');
            holiBtn.classList.add('hidden');
        } else {
            // å€’æ•¸ä¸‹ç­
            timerEl.innerText = formatDiff(target - now);
            timerEl.style.color = "white";
            quoteEl.innerText = quotes.work[Math.floor(Math.random()*quotes.work.length)];
            statusEl.innerText = `é è¨ˆ ${customTime} ä¸‹ç­`;
            dot.style.background = "var(--success)";
            offBtn.classList.add('hidden');
            holiBtn.classList.remove('hidden');
        }
    }

    function formatDiff(ms) {
        let m = Math.floor(ms / 60000);
        let s = Math.floor((ms % 60000) / 1000);
        return `${m}:${s.toString().padStart(2, '0')}`;
    }

    function finishWork() {
        confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
        localStorage.setItem('isOff', 'true');
        update();
    }

    function setHoliday() {
        if(confirm("ç¢ºå®šä»Šå¤©ä¸å‹å‹•ï¼Ÿ")) {
            localStorage.setItem('isHoli', 'true');
            update();
        }
    }

    function startExtraWork() {
        localStorage.setItem('forceWork', 'true');
        update();
    }

    function adjustTime() {
        const time = prompt("ä»Šæ—¥å¹¾é»è§£æ”¾ï¼Ÿ(æ ¼å¼ 24h, å¦‚ 18:15)", customTime);
        if (time) {
            localStorage.setItem('offTime', time);
            customTime = time;
            update();
        }
    }

    // æ¯å¤©é‡ç½®
    const today = new Date().toDateString();
    if (localStorage.getItem('lastDate') !== today) {
        localStorage.clear();
        localStorage.setItem('lastDate', today);
    }

    setInterval(update, 1000);
    update();
</script>

</body>
</html>
