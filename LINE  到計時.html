<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å‡ºç¤¾æœƒç¨‹åº</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg: #000000;
            --card: #111111;
            --accent: #bb86fc;
            --danger: #ff4d4d;
            --success: #00ff88;
            --text: #ffffff;
        }

        body {
            margin: 0; background: var(--bg); color: var(--text);
            font-family: 'Inter', -apple-system, sans-serif;
            display: flex; align-items: center; justify-content: center; height: 100vh;
        }

        .container {
            width: 85%; max-width: 380px; padding: 50px 20px;
            background: var(--card); border-radius: 40px;
            text-align: center; border: 1px solid #222;
            box-shadow: 0 30px 60px rgba(0,0,0,0.5);
        }

        .status-badge {
            display: inline-flex; align-items: center; gap: 8px;
            font-size: 0.75rem; color: #666; margin-bottom: 30px;
            padding: 5px 15px; border-radius: 20px; border: 1px solid #333;
        }

        #timer {
            font-size: 3.8rem; font-weight: 200; margin: 15px 0;
            letter-spacing: -1px; font-variant-numeric: tabular-nums;
            font-family: 'Courier New', Courier, monospace; /* ä½¿ç”¨ç­‰å¯¬å­—é«”é˜²æ­¢æ•¸å­—æŠ–å‹• */
        }

        .quote { font-size: 0.9rem; color: #888; min-height: 40px; margin-bottom: 40px; }

        .btn-group { display: flex; flex-direction: column; gap: 12px; }
        .btn {
            width: 100%; padding: 18px; border-radius: 20px; border: none;
            font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: 0.3s;
        }
        .btn-primary { background: var(--text); color: var(--bg); }
        .btn-outline { background: transparent; border: 1px solid #333; color: #888; }
        .btn:active { transform: scale(0.95); }

        .settings { font-size: 0.75rem; color: #444; margin-top: 25px; cursor: pointer; text-decoration: underline; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="container">
    <div class="status-badge">
        <span id="statusText">ç³»çµ±å¾…å‘½</span>
    </div>
    
    <div id="timer">00:00:00</div>
    
    <div class="quote" id="quote">æ­£åœ¨è®€å–ä»Šæ—¥å‰©é¤˜èƒ½é‡...</div>

    <div class="btn-group">
        <button id="offWorkBtn" class="btn btn-primary hidden" onclick="finishWork()">ğŸš€ å•Ÿå‹•ä¸‹ç­ç¨‹åº</button>
        <button id="extraWorkBtn" class="btn btn-outline hidden" onclick="startExtraWork()">ğŸ’€ æ¥å—å¤–æ´¾åŠ ç­</button>
        <button id="holidayBtn" class="btn btn-outline" onclick="setHoliday()">ğŸ–ï¸ ä»Šå¤©æ²’æˆ‘çš„äº‹</button>
    </div>

    <div class="settings" onclick="adjustTime()">ä¿®æ”¹ä¸‹ç­æ™‚é–“ (ç›®å‰: <span id="timeLabel">18:15</span>)</div>
</div>

<script>
    let offTime = localStorage.getItem('offTime') || "18:15";
    document.getElementById('timeLabel').innerText = offTime;

    const quotes = {
        work: ["åªè¦æˆ‘ä¸åŠªåŠ›ï¼Œè€é—†å°±æ²’æ³•éæƒ³è¦çš„ç”Ÿæ´»ã€‚", "è–ªæ°´ä¸æ˜¯å·¥è³‡ï¼Œæ˜¯ç²¾ç¥æå¤±è£œå„Ÿã€‚", "è·é›¢è‡ªç”±å·²é€²å…¥å€’æ•¸éšæ®µã€‚"],
        slave: ["åµæ¸¬åˆ°éæ³•åŠ ç­...ç³»çµ±éç†±ä¸­ã€‚", "ç”Ÿå‘½æ­£ä»¥ç§’ç‚ºå–®ä½æµå‘å…¬å¸ã€‚", "é€™ç¨®è‹¦æˆ‘åƒå¾—æ¶ˆï¼Œä½†ä¸æƒ³åƒã€‚"],
        free: ["ç™»å‡ºæˆåŠŸã€‚è«‹ç›¡æƒ…äº«å—äººé¡ç”Ÿæ´»ã€‚", "åˆ¥çœ‹è¢å¹•äº†ï¼Œå»çœ‹æ˜Ÿæ˜Ÿå§ã€‚", "ä»Šæ—¥å‹å‹•åŠ›å·²å…¨æ•¸å”®ç½„ã€‚"],
        weekend: ["é€±æœ«æ„‰å¿«ï¼å¸Œæœ› LINE ç¾¤çµ„æ°¸é å®‰éœã€‚", "åµæ¸¬åˆ°ä¾‹å‡æ—¥ã€‚å»ºè­°é€²å…¥æ–·ç¶²æ¨¡å¼ã€‚"]
    };

    function update() {
        const now = new Date();
        const day = now.getDay(); 
        const isWeekend = (day === 0 || day === 6);
        const [h, m] = offTime.split(":").map(Number);
        
        const isOff = localStorage.getItem('isOff') === 'true';
        const isHoli = localStorage.getItem('isHoli') === 'true';
        const forceWork = localStorage.getItem('forceWork') === 'true';

        const timerEl = document.getElementById('timer');
        const quoteEl = document.getElementById('quote');
        const statusEl = document.getElementById('statusText');
        const offBtn = document.getElementById('offWorkBtn');
        const extraBtn = document.getElementById('extraWorkBtn');
        const holiBtn = document.getElementById('holidayBtn');

        // 1. é€±æœ«æ¨¡å¼
        if (isWeekend && !forceWork) {
            timerEl.innerText = "CHILL";
            timerEl.style.color = "var(--accent)";
            quoteEl.innerText = quotes.weekend[0];
            statusEl.innerText = "âœ¨ é€±æœ«ä¾‹å‡ä¼‘æ¯ä¸­";
            offBtn.classList.add('hidden');
            holiBtn.classList.add('hidden');
            extraBtn.classList.remove('hidden');
            return;
        }

        // 2. è‡ªç”±æ¨¡å¼ (å·²ä¸‹ç­æˆ–ä»Šæ—¥æ”¾å‡)
        if (isOff || isHoli) {
            timerEl.innerText = "FREE";
            timerEl.style.color = "var(--accent)";
            quoteEl.innerText = quotes.free[Math.floor(Math.random()*quotes.free.length)];
            statusEl.innerText = "ğŸ”‹ è‡ªç”±èƒ½é‡æ»¿æ ¼";
            offBtn.classList.add('hidden');
            holiBtn.classList.add('hidden');
            extraBtn.classList.add('hidden');
            return;
        }

        // 3. å·¥ä½œæˆ–åŠ ç­æ¨¡å¼
        let target = new Date();
        target.setHours(h, m, 0, 0);
        
        if (now >= target) {
            // å·²éä¸‹ç­æ™‚é–“ï¼ˆåŠ ç­ä¸­ï¼‰
            timerEl.innerText = formatHMS(now - target);
            timerEl.style.color = "var(--danger)";
            quoteEl.innerText = quotes.slave[Math.floor(Math.random()*quotes.slave.length)];
            statusEl.innerText = "ğŸš¨ åµæ¸¬åˆ°è¶…æ™‚å‹å‹•";
            offBtn.classList.remove('hidden');
            holiBtn.classList.add('hidden');
        } else {
            // å€’æ•¸ä¸‹ç­
            timerEl.innerText = formatHMS(target - now);
            timerEl.style.color = "var(--text)";
            quoteEl.innerText = quotes.work[Math.floor(Math.random()*quotes.work.length)];
            statusEl.innerText = `âš™ï¸ è·é›¢ ${offTime} ç™»å‡º`;
            offBtn.classList.add('hidden');
            holiBtn.classList.remove('hidden');
        }
        extraBtn.classList.add('hidden');
    }

    function formatHMS(ms) {
        let hrs = Math.floor(ms / 3600000);
        let mins = Math.floor((ms % 3600000) / 60000);
        let secs = Math.floor((ms % 60000) / 1000);
        return `${hrs.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }

    function finishWork() {
        confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 } });
        localStorage.setItem('isOff', 'true');
        update();
    }

    function setHoliday() {
        if(confirm("ç¢ºå®šå•Ÿå‹•æ”¾å‡æ¨¡å¼ï¼Ÿ")) {
            localStorage.setItem('isHoli', 'true');
            update();
        }
    }

    function startExtraWork() {
        localStorage.setItem('forceWork', 'true');
        update();
    }

    function adjustTime() {
        const time = prompt("ä»Šæ—¥å¹¾é»ä¸‹ç­ï¼Ÿ(ä¾‹å¦‚ 18:15)", offTime);
        if (time && /^([01]\d|2[0-3]):?([0-5]\d)$/.test(time)) {
            localStorage.setItem('offTime', time);
            offTime = time;
            document.getElementById('timeLabel').innerText = offTime;
            update();
        } else if (time) {
            alert("è«‹è¼¸å…¥æ­£ç¢ºçš„æ ¼å¼ (ä¾‹å¦‚ 18:15)");
        }
    }

    // æ›æ—¥è‡ªå‹•é‡ç½®
    const today = new Date().toDateString();
    if (localStorage.getItem('lastDate') !== today) {
        localStorage.clear();
        localStorage.setItem('lastDate', today);
    }

    setInterval(update, 1000);
    update();
</script>

</body>
</html>
